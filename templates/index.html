{% extends "base.html" %}

{% block content %}
<h1>Project Echo</h1>
<form method="post" action="{{ url_for('index') }}" class="journal-entry-form">
    <select name="project" class="project-input" aria-label="Select Project (Optional)">
        <option value="">-- Select Project (Optional) --</option>
        {% for project_name in active_projects %}
        <option value="{{ project_name }}">{{ project_name }}</option>
        {% endfor %}
    </select>
    <textarea name="content" rows="4" cols="50" placeholder="What just happened? What's next?"></textarea>
    <br>
    <button type="submit">Log Entry</button>
</form>

<h2>Past Entries</h2>
<div class="entries-by-date">
    {% for date, entries in entries_by_date %}
    <div class="date-section">
        <h3 class="date-header clickable" data-target="entries-{{ date }}">
            <span>{{ date }}</span>
            {% set total_elapsed_minutes = total_durations[date] %}

            {% if total_elapsed_minutes is defined and total_elapsed_minutes > 0 %}
                {% set total_hours = total_elapsed_minutes // 60 %}
                {% set total_minutes_remaining = total_elapsed_minutes % 60 %}

                <span class="total-time-display">
                    ({% if total_hours > 0 %}{{ total_hours }}h {% endif %}{{ total_minutes_remaining }}min)
                </span>
            {% endif %}
        </h3>

        <div id="entries-{{ date }}" class="entries-content-wrapper hidden">
            <ul class="entries-list" style="list-style-type: none; padding: 0;">
                {% for entry in entries %}
                <li class="entry">
                    <a href="{{ url_for('calendar_bp.edit', entry_id=entry.id) }}" class="edit-link">✏️</a>
                    <span class="entry-content-wrapper">
                        <span class="timestamp">{{ entry.timestamp.split(' ')[1] }}</span>

                        {% if entry.project %}
                        <a href="{{ url_for('projects_bp.project_dashboard', project_name=entry.project) }}" class="project-dashboard-link">
                            <span class="entry-project">[{{ entry.project }}]</span>
                        </a>
                        {% endif %}

                        - {{ entry.content | format_entry | safe }}

                        {% if entry.duration_minutes %}
                            {% set hours = entry.duration_minutes // 60 %}
                            {% set minutes = entry.duration_minutes % 60 %}

                            <span class="time-elapsed">
                                ({{ hours }}h {{ minutes }}min)
                            </span>
                        {% endif %}
                    </span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}