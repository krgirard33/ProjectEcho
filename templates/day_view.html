{% extends "base.html" %}

{% block title %}Entries for {{ date }} - Project Echo{% endblock %}

{% block content %}
<h1>Entries for {{ date }}</h1>
<div class="journal-entry-form">
    <form method="post" action="{{ url_for('calendar_bp.view_day', date=date) }}" class="journal-entry-form">
        <select name="project" class="project-input" aria-label="Select Project (Optional)">
            <option value="">-- Select Project (Optional) --</option>
            {% for project_name in active_projects %}
            <option value="{{ project_name }}">{{ project_name }}</option>
            {% endfor %}
        </select>

        <textarea name="content" rows="4" cols="50" placeholder="What just happened? What's next?"></textarea>
        <br>
        <button type="submit">Log Entry</button>
    </form>
</div>

<div class="entries-list-container">
    <h2>
        <span>Journal Entries</span>

        {% if total_elapsed_minutes is defined %}
            {% set total_hours = total_elapsed_minutes // 60 %}
            {% set total_minutes_remaining = total_elapsed_minutes % 60 %}

            <span class="total-time-display">
                ({% if total_hours > 0 %}{{ total_hours }}h {% endif %}{{ total_minutes_remaining }}min)
            </span>
        {% endif %}
    </h2>
    <ul class="entries-list" style="list-style-type: none; padding: 0;">
        {% for entry in entries %}
        <li class="entry">
            <a href="{{ url_for('calendar_bp.edit', entry_id=entry.id) }}" class="edit-link">✏️</a>
            <span class="entry-content-wrapper">
                <span class="timestamp">{{ entry.timestamp.split(' ')[1] }}</span>

                {% if entry.project %}
                <a href="{{ url_for('projects_bp.project_dashboard', project_name=entry.project) }}" class="project-dashboard-link">
                    <span class="entry-project">[{{ entry.project }}]</span>
                </a>
                {% endif %}

                - {{ entry.content | format_entry | safe }}

                {% if entry.duration_minutes %}
                {% set hours = entry.duration_minutes // 60 %}
                {% set minutes = entry.duration_minutes % 60 %}

                <span class="time-elapsed">
                    ({{ hours }}h {{ minutes }}min)
                </span>
                {% endif %}
            </span>
        </li>
        {% endfor %}
    </ul>
</div>
<div class="finished-tasks-section">
    <h2>Finished Tasks</h2>
    {% if finished_todos %}
    <ul class="finished-tasks-list" style="list-style-type: none; padding: 0;">
        {% for todo in finished_todos %}
        <li class="finished-todo-item">
            <a href="{{ url_for('todo_bp.edit_todo', item_id=todo.id) }}" class="edit-link">✏️</a>
            {% if todo.project %}
            <a href="{{ url_for('projects_bp.project_dashboard', project_name=todo.project) }}" class="project-dashboard-link">
                <span class="entry-project">[{{ todo.project }}]</span>
            </a>
            {% endif %}

            - {{ todo.item_html }}

        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p class="no-tasks-message">No tasks were marked finished on this day.</p>
    {% endif %}
</div>
{% endblock %}